<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PP434 Project - Gabriel Costa</title>

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <link rel="stylesheet" type="text/css" href="Example3.css"> 
    <style>
        body { font-family: 'Helvetica', sans-serif; max-width: 900px; margin: auto; padding: 20px; background-color: #fcfcfc; }
        .btn-container { margin: 10px 0 20px 0; }
        .data-btn {
            background-color: #ffffff; border: 1px solid #003366; padding: 6px 12px;
            text-decoration: none; color: #003366; font-size: 0.75em; border-radius: 4px; 
            font-weight: bold; transition: 0.2s; margin-right: 5px;
        }
        .data-btn:hover { background-color: #003366; color: white; }
        .chart-container { margin-bottom: 60px; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h2 { color: #003366; border-bottom: 2px solid #003366; display: inline-block; padding-bottom: 5px; }
    </style>
</head>

<body>
    <header>
        <h1>Structural Poverty and Labor Markets in Brazil</h1>
        <p><em>By Gabriel Costa | LSE Master of Public Policy</em></p>
    </header>
    
    <main>
        <section id="Aims">
            <h2>Aims</h2>
            <p>This project investigates the effectiveness of employability as a driver for poverty reduction. By analyzing Maranhão and Piauí, I test if labor market shocks can overcome deep structural deficits.</p>
        </section>

        <section id="Data">
            <h2>Data</h2>
            <p>Primary data is sourced from the <strong>IBGE SIDRA API</strong>. I utilize GeoJSON for spatial mapping and JSON time-series for policy evaluation.</p>
        </section>

        <hr>

        <article class="chart-container">
            <h3>Chart 1: Spatiotemporal Poverty Evolution</h3>
            <div class="btn-container">
                <a class="data-btn" href="data/brazil_poverty_geo_final.json" target="_blank">View Geo-Data</a>
                <a class="data-btn" href="#" target="_blank">View Python Workflow</a>
            </div>
            <p>Move the slider below to observe how regional poverty evolved from 2016 to 2022. This visualization uses filtered Geoshape features to ensure seamless transitions.</p>
            <div id="ChartMap"></div>
        </article>

        <article class="chart-container">
            <h3>Chart 2: Policy Evaluation (Difference-in-Differences)</h3>
            <div class="btn-container">
                <a class="data-btn" href="data/did_analysis_data.json" target="_blank">View Data</a>
            </div>
            <p>Analysis of the 2016 policy shock. The parallel trends prior to intervention validate the counterfactual choice, while the post-2016 results show structural resistance.</p>
            <div id="ChartDiD"></div>
        </article>

        <article class="chart-container">
            <h3>Chart 3: The Infrastructure Bottleneck (OLS Regression)</h3>
            <div class="btn-container">
                <a class="data-btn" href="data/multidimensional_poverty.json" target="_blank">View Data</a>
            </div>
            <p>This scatter plot reveals the negative correlation between sanitation access and poverty rates, highlighting a significant structural barrier.</p>
            <div id="ChartOLS"></div>
        </article>

        <article class="chart-container">
            <h3>Chart 4: Advanced Interactive Exploration</h3>
            <div class="btn-container">
                <a class="data-btn" href="data/brazil_poverty_geo_final.json" target="_blank">View Data</a>
            </div>
            <p><strong>Interactivity:</strong> Select states in the legend to highlight their multidimensional trajectory over time.</p>
            <div id="ChartInteractive"></div>
        </article>

        <hr>

        <section id="Tools">
            <h2>Tools</h2>
            <p>Data processing performed in <strong>Python (Pandas)</strong>. Interactive visualizations built using <strong>Vega-Lite</strong> and hosted via <strong>GitHub Pages</strong>.</p>
        </section>

        <section id="Conclusions">
            <h2>Conclusions</h2>
            <p>Evidence suggests that isolated employability shocks are insufficient without aggressive investments in basic infrastructure and human capital.</p>
        </section>
    </main>

    <script>
        const opt = {"mode": "vega-lite", "actions": false};

        // 1. MAP (Fixed with filter inside mark)
        const specMap = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "width": 700, "height": 450,
          "params": [{
            "name": "YearSelect",
            "value": 2022,
            "bind": {"input": "range", "min": 2016, "max": 2022, "step": 1, "name": "Select Year: "}
          }],
          "data": {
            "url": "data/brazil_poverty_geo_final.json",
            "format": {"property": "features"}
          },
          "transform": [
            {"filter": "datum.properties.Year == YearSelect"}
          ],
          "projection": {"type": "mercator"},
          "mark": {"type": "geoshape", "stroke": "white"},
          "encoding": {
            "color": {
              "field": "properties.Poverty_Rate",
              "type": "quantitative",
              "scale": {"scheme": "reds", "domain": [20, 60]},
              "title": "Poverty Rate (%)"
            },
            "tooltip": [
              {"field": "properties.name", "title": "State"},
              {"field": "properties.Poverty_Rate", "title": "Rate %", "format": ".1f"}
            ]
          }
        };
        vegaEmbed('#ChartMap', specMap, opt);

        // 2. DiD Chart
        const specDiD = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "data": {"url": "data/did_analysis_data.json"},
          "width": 600, "height": 300,
          "layer": [
            {"mark": {"type": "line", "point": true}, "encoding": {
              "x": {"field": "Year", "type": "ordinal", "title": "Year"},
              "y": {"field": "Poverty_Rate", "type": "quantitative", "title": "Poverty Rate (%)", "scale": {"zero": false}},
              "color": {"field": "State", "type": "nominal", "scale": {"range": ["#003366", "#d62728"]}}
            }},
            {"mark": {"type": "rule", "color": "black", "strokeDash": [4,4]}, "encoding": {"x": {"datum": 2016}}}
          ]
        };
        vegaEmbed('#ChartDiD', specDiD, opt);

        // 3. OLS Regression
        const specOLS = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "data": {"url": "data/multidimensional_poverty.json"},
          "width": 600, "height": 300,
          "layer": [
            {"mark": "point", "encoding": {
              "x": {"field": "Sanitation_Access", "type": "quantitative", "title": "Sanitation (%)"},
              "y": {"field": "Poverty_Rate", "type": "quantitative", "title": "Poverty (%)"},
              "color": {"field": "State", "type": "nominal"}
            }},
            {"mark": {"type": "line", "color": "gray", "strokeDash": [4,4]}, "transform": [{"regression": "Poverty_Rate", "on": "Sanitation_Access"}], "encoding": {
              "x": {"field": "Sanitation_Access", "type": "quantitative"},
              "y": {"field": "Poverty_Rate", "type": "quantitative"}
            }}
          ]
        };
        vegaEmbed('#ChartOLS', specOLS, opt);

        // 4. Interactive Bubble
        const specInteractive = {
          "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
          "data": {"url": "data/brazil_poverty_geo_final.json"},
          "width": 600, "height": 350,
          "params": [{
            "name": "stateClick",
            "select": {"type": "point", "fields": ["properties.name"]},
            "bind": "legend"
          }],
          "mark": {"type": "circle", "size": 150, "filled": true},
          "encoding": {
            "x": {"field": "properties.Poverty_Rate", "type": "quantitative", "title": "Poverty (%)"},
            "y": {"field": "properties.Year", "type": "quantitative", "title": "Year", "scale": {"zero": false}},
            "color": {"field": "properties.name", "type": "nominal", "title": "State"},
            "opacity": {"condition": {"param": "stateClick", "value": 1}, "value": 0.1}
          }
        };
        vegaEmbed('#ChartInteractive', specInteractive, opt);
    </script>
</body>
</html>